<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SP-HUB | å‰µå»ºåœ˜éšŠ</title>
  {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/04a6b0e02e.js" crossorigin="anonymous"></script>
  <style>
    .tag-container {
      margin-top: 10px;
    }
    .selected-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .tag {
      background-color: rgba(42, 45, 67, 0.7); /* ä½¿ç”¨#2A2D43çš„RGBå€¼ä¸¦è¨­ç½®0.7é€æ˜åº¦ */
      color: white;
      padding: 5px 10px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      gap: 5px;
      animation: tagPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: all 0.2s ease;
    }
    .tag:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    .tag-remove {
      cursor: pointer;
      font-size: 12px;
    }
    @keyframes tagPop {
      0% {
        opacity: 0;
        transform: scale(0.8);
      }
      50% {
        opacity: 0.5;
        transform: scale(1.05);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
  </style>
</head>
<body>

  <header class="glass-header" style="padding: 0.5rem 2rem">

    <nav class="nav-container">
        <a href="{% url 'index' %}" style="text-decoration: none; color: black;"><h1>SP-HUB</h1></a>
        
        <form method="GET" action="{% url 'explore' %}" class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" 
                   class="search-bar" 
                   name="search_query"
                   placeholder="æœå°‹å°ˆæ¡ˆã€ä½œè€…æˆ–æè¿°..."
                   value="{{ search_query|default:'' }}">
            <button type="submit" class="search-btn" style="display: none;"></button>
        </form>
        <div class="nav-links">
            <a href="{% url 'create_post' %}" class="header-nav-btn neon-hover"><i class="fas fa-plus-circle"></i>ç™¼å¸ƒæ–‡ç« </a>
            <a href="{% url 'explore' %}" class="header-nav-btn neon-hover"><i class="fas fa-users"></i>æ¢ç´¢åœ˜éšŠ</a>

            {% if request.user.is_authenticated %}
                <div class="user-dropdown">
                    <button class="user-profile header-nav-btn neon-hover" style="background: var(--primary-green); color: white;">
                        {% if request.user.avatar %}
                            <img src="{{ request.user.avatar.url }}" alt="{{ request.user.username }}" style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;">
                        {% else %}
                            <i class="fas fa-user-astronaut"></i>
                        {% endif %}
                        <span><a href="{% url 'profile_with_username' request.user.username %}" style="text-decoration: none; color: inherit;">{{ request.user.username }}</a></span>
                    </button>
                    <div class="dropdown-content">
                        <a href="{% url 'profile' %}"><i class="fas fa-user"></i>å€‹äººè³‡æ–™</a>
                        <a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i>ç™»å‡º</a>
                    </div>
                </div>
            {% else %}
                <a href="{% url 'login' %}" class="header-nav-btn neon-hover"><i class="fas fa-sign-in-alt"></i>ç™»å…¥</a>
                <a href="{% url 'register' %}" class="header-nav-btn neon-hover"><i class="fas fa-user-plus"></i>è¨»å†Š</a>
            {% endif %}
        </div>
    </nav>
    <div class="header-gradient"></div>
</header>

<div class="content" style="margin-top: 2%;">
  <div class="section-header">
    <h2 class="section-title" style="text-align: center;">
      <span class="highlight">ç™¼å¸ƒæ–‡ç« </span>
    </h2>
    <div class="decorative-line"></div>
  </div>

  <div class="form-card">
    <form action="" method="POST" id="post-form">
      {% csrf_token %}
      <div class="form-group">
        <label for="post_type"><i class="fas fa-file-alt"></i> æ–‡ç« é¡å‹</label>
        <select id="post_type" name="post_type" class="form-input">
          <option value="team">åœ˜éšŠæ‹›å‹Ÿ</option>
          <option value="project">ä½œå“åˆ†äº«</option>
        </select>
      </div>
      <div class="form-group">
        <label for="title"><i class="fas fa-heading"></i> æ¨™é¡Œ</label>
        <input type="text" id="title" name="title" placeholder="è¼¸å…¥æ¨™é¡Œ" required class="form-input">
      </div>
      <div class="form-group">
        <label for="description"><i class="fas fa-comment-alt"></i> å°ˆæ¡ˆç°¡ä»‹</label>
        <input type="text" id="description" name="description" 
               placeholder="ç°¡çŸ­æè¿°å°ˆæ¡ˆå…§å®¹ï¼ˆå°‡é¡¯ç¤ºæ–¼æœå°‹é è¦½ï¼‰" 
               required class="form-input"
               maxlength="80">
      </div>
      <div class="form-group">
        <label for="tags"><i class="fas fa-tags"></i> å°ˆæ¡ˆæ¨™ç±¤</label>
        <div class="tag-container">
          <input type="text" id="tag-input" placeholder="è¼¸å…¥æ¨™ç±¤ï¼ˆæœ€å¤š3å€‹ï¼‰" class="form-input">
          <div id="selected-tags" class="selected-tags"></div>
          <input type="hidden" id="tags" name="tags" required>
        </div>
      </div>
      <div class="form-group">
        <!-- æ­¤ label æ”¹æˆæŒ‡å‘ #editor -->
        <label for="editor"><i class="fas fa-pen-fancy"></i> å°ˆæ¡ˆè©³æƒ…</label>
        <div id="editor">
          <p>ğŸš€ å°ˆæ¡ˆç›®æ¨™ï¼š</p>
          <p>åœ¨æ­¤è©³ç´°èªªæ˜æ‚¨çš„å°ˆæ¡ˆç›®æ¨™ã€æŠ€è¡“éœ€æ±‚èˆ‡åˆä½œæ–¹å¼...</p>
          <p><br/></p>
        </div>
      </div>
      <input type="hidden" id="hidden-content" name="content">
      <button type="submit" class="nav-btn full-width-btn">
        <i class="fas fa-rocket"></i>
        <span>ç™¼ä½ˆæ–‡ç« </span>
      </button>
    </form>
  </div>
</div>

<footer>
  <div class="footer" style="text-align: center;">
    <p>Copyright Â© 2025 Side Project Hub. All rights reserved.</p>
  </div>
</footer>

<!-- Include the Quill library -->
<script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function(){
  // æ¨™ç±¤ç›¸é—œåŠŸèƒ½
  const tagInput = document.getElementById('tag-input');
  const selectedTags = document.getElementById('selected-tags');
  const tagsHidden = document.getElementById('tags');
  let tags = [];

  tagInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ',') {
      e.preventDefault();
      const tag = this.value.trim();
      if (tag && tags.length < 3 && !tags.includes(tag)) {
        addTag(tag);
      }
      this.value = '';
    }
  });
  
  // ç›£è½ç©ºæ ¼éµï¼Œè™•ç†#é–‹é ­çš„æ¨™ç±¤
  tagInput.addEventListener('input', function(e) {
    const value = this.value;
    if (value.startsWith('') && value.endsWith(' ')) {
      const tag = value.slice(0, -1).trim(); // ç§»é™¤#å’Œç©ºæ ¼
      if (tag && tags.length < 3 && !tags.includes(tag)) {
        addTag(tag);
        this.value = '';
      }
    }
  });
  
  // ä¹Ÿç›£è½ç©ºæ ¼éµæŒ‰ä¸‹äº‹ä»¶ï¼Œç¢ºä¿å³ä½¿ç”¨æˆ¶ç›´æ¥æŒ‰ç©ºæ ¼ä¹Ÿèƒ½è§¸ç™¼
  tagInput.addEventListener('keydown', function(e) {
    if (e.key === ' ' && this.value.startsWith('#')) {
      const tag = this.value.slice(1).trim();
      if (tag && tags.length < 3 && !tags.includes(tag)) {
        e.preventDefault(); // é˜²æ­¢ç©ºæ ¼è¢«è¼¸å…¥
        addTag(tag);
        this.value = '';
      }
    }
  });

  function addTag(tag) {
    // ä¿å­˜å®Œæ•´æ¨™ç±¤å…§å®¹ï¼Œä½†åœ¨é¡¯ç¤ºæ™‚å¯èƒ½æœƒæˆªæ–·
    tags.push(tag);
    updateTags();
  }

  function removeTag(tag) {
    tags = tags.filter(t => t !== tag);
    updateTags();
  }

  function updateTags() {
    selectedTags.innerHTML = tags.map(tag => {
      // é¡¯ç¤ºæ™‚å¦‚æœæ¨™ç±¤å¤ªé•·å‰‡æˆªæ–·ï¼Œä½†ä¿å­˜å®Œæ•´å…§å®¹
      const displayTag = tag.length > 15 ? tag.substring(0, 12) + '...' : tag;
      return `
      <span class="tag" title="${tag}">
        #${displayTag}
        <span class="tag-remove" onclick="removeTag('${tag}')">âœ•</span>
      </span>
      `;
    }).join('');
    tagsHidden.value = JSON.stringify(tags);
    tagInput.disabled = tags.length >= 3;
    tagInput.placeholder = tags.length >= 3 ? 'å·²é”åˆ°æœ€å¤§æ¨™ç±¤æ•¸é‡' : 'è¼¸å…¥æ¨™ç±¤ï¼ˆæœ€å¤š3å€‹ï¼‰';
  }

  // å°‡removeTagå‡½æ•¸è¨­ç‚ºå…¨å±€å‡½æ•¸
  window.removeTag = removeTag;

  // è¨­å®šå­—å‹
  var fonts = ['SimSun', 'SimHei', 'Microsoft-YaHei', 'KaiTi', 'FangSong', 'Arial', 'Times-New-Roman', 'sans-serif'];
  var Font = Quill.import('formats/font');
  Font.whitelist = fonts;
  Quill.register(Font, true);

  // è¨­å®šå·¥å…·åˆ—é¸é …
  const toolbarOptions = [
    [{'size': ['small', false, 'large', 'huge']}],
    [{'font': fonts}],
    ['bold', 'italic', 'underline', 'strike'],
    ['blockquote', 'code-block'],
    ['link', 'image', 'video'],
    [{'list': 'ordered'}, {'list': 'bullet'}, {'list': 'check'}],
    [{'color': []}, {'background': []}],
    [{'align': []}],
  ];

  // åˆå§‹åŒ– Quill ç·¨è¼¯å™¨
  const quill = new Quill('#editor', {
    theme: 'snow',
    modules: {
      toolbar: toolbarOptions
    },
  });

  // å–å¾—è¡¨å–®èˆ‡éš±è—æ¬„ä½
  const form = document.getElementById('post-form');
  var hiddenInput = document.getElementById('hidden-content'); 
 
  form.addEventListener('submit', function(event) {
    event.preventDefault();
    hiddenInput.value = quill.root.innerHTML;
    form.submit();
  });
});
</script>
</body>
</html>
